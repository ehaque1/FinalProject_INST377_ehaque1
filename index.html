<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Coffee App</title>
  <link rel="stylesheet" href="style.css">
</head>
<body>
  <header>
    <h1>Superbase Coffee</h1>
    <nav>
      <a href="index.html">Home</a>
      <a href="about.html">About</a>
      <a href="explore.html">Explore</a>
    </nav>
  </header>

  <main>
    <section>
      <h2>Our Coffee Selection</h2>
      <div id="coffee-list" class="grid-container">
        <p>Loading coffees...</p>
      </div>
    </section>

    <section>
      <h2>Add New Coffee</h2>
      <form id="coffee-form">
        <div class="form-group">
          <label for="name">Coffee Name*</label>
          <input type="text" id="name" required>
        </div>
        
        <div class="form-group">
          <label for="origin">Origin*</label>
          <input type="text" id="origin" required>
        </div>
        
        <div class="form-group">
          <label for="brewing-method">Brewing Method*</label>
          <input type="text" id="brewing-method" required>
        </div>
        
        <div class="form-group">
          <label for="description">Description</label>
          <textarea id="description"></textarea>
        </div>
        
        <div class="form-group">
          <label for="strength">Strength (1-5)</label>
          <input type="number" id="strength" min="1" max="5">
        </div>
        
        <div class="form-group">
          <label for="image-url">Image URL</label>
          <input type="url" id="image-url">
        </div>
        
        <button type="submit">Add Coffee</button>
      </form>
      
      <div id="error-message" class="message error"></div>
      <div id="success-message" class="message success"></div>
    </section>
  </main>

  <script>
    const API_BASE = '/api';
    const errorElement = document.getElementById('error-message');
    const successElement = document.getElementById('success-message');

    async function loadCoffees() {
      try {
        showLoading();
        const response = await fetch(`${API_BASE}/coffees`);
        
        if (!response.ok) {
          throw new Error(`HTTP error! Status: ${response.status}`);
        }
        
        const coffees = await response.json();
        const container = document.getElementById('coffee-list');
        container.innerHTML = '';
        
        if (coffees.length === 0) {
          container.innerHTML = '<p class="no-data">No coffees found. Add one above!</p>';
          return;
        }
        
        coffees.forEach(coffee => {
          const card = document.createElement('div');
          card.className = 'card';
          card.innerHTML = `
            ${coffee.image_url ? `<img src="${coffee.image_url}" alt="${coffee.name}" class="coffee-image">` : ''}
            <div class="card-content">
              <h3>${coffee.name}</h3>
              <p><strong>Origin:</strong> ${coffee.origin}</p>
              <p><strong>Brew Method:</strong> ${coffee.brewing_method}</p>
              ${coffee.description ? `<p class="description">${coffee.description}</p>` : ''}
              ${coffee.strength ? `<p><strong>Strength:</strong> ${'★'.repeat(coffee.strength)}${'☆'.repeat(5 - coffee.strength)}</p>` : ''}
            </div>
          `;
          container.appendChild(card);
        });
      } catch (error) {
        console.error('Error loading coffees:', error);
        showError(error.message);
      }
    }

    document.getElementById('coffee-form').addEventListener('submit', async (e) => {
      e.preventDefault();
      clearMessages();
      
      const coffee = {
        name: document.getElementById('name').value.trim(),
        origin: document.getElementById('origin').value.trim(),
        brewing_method: document.getElementById('brewing-method').value.trim(),
        description: document.getElementById('description').value.trim(),
        strength: document.getElementById('strength').value,
        image_url: document.getElementById('image-url').value.trim()
      };
      
      try {
        showLoading('Adding coffee...');
        const response = await fetch(`${API_BASE}/coffees`, {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify(coffee)
        });

        if (!response.ok) {
          const errorData = await response.json();
          throw new Error(errorData.error || 'Failed to add coffee');
        }

        const result = await response.json();
        showSuccess(`Successfully added ${result.name}!`);
        document.getElementById('coffee-form').reset();
        loadCoffees();
      } catch (error) {
        console.error('Error adding coffee:', error);
        showError(error.message);
      }
    });

    function showLoading(message = 'Loading...') {
      clearMessages();
      successElement.textContent = message;
      successElement.style.display = 'block';
    }

    function showSuccess(message) {
      clearMessages();
      successElement.textContent = message;
      successElement.style.display = 'block';
    }

    function showError(message) {
      clearMessages();
      errorElement.textContent = message;
      errorElement.style.display = 'block';
    }

    function clearMessages() {
      errorElement.style.display = 'none';
      successElement.style.display = 'none';
      errorElement.textContent = '';
      successElement.textContent = '';
    }

    // Initial load
    loadCoffees();
  </script>
</body>
</html>